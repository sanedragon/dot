#!/usr/bin/python
import sys
import os
import glob
import subprocess

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: %s pattern [pattern ...]" % os.path.split(sys.argv[0])[1])
        sys.exit(0)

    for arg in sys.argv[1:]:
        files = glob.glob(arg)

        if len(files) == 0:
            continue

        for file in files:
            directory = os.path.split(file)[0]
            filename = os.path.split(file)[1]
            name = os.path.splitext(filename)[0]
            try:
                # convert file to audiodump.wav
                subprocess.check_call([
                    "mplayer", "-quiet", "-vo", "null", "-vc", "null", "-ao", "pcm:fast", file
                ])

                # encode to mp3
                subprocess.check_call(["lame", "-V0", "audiodump.wav", name + ".mp3"])
            except Exception as e:
                print(e)
            finally:
                if os.path.exists("audiodump.wav"):
                    os.remove("audiodump.wav")
